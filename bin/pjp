#!/usr/bin/env bash

abort() {
	echo "$@"
	exit 1
}

compile() {
	javac -source "$JDK_VERSION" -target "$JDK_VERSION" pjp.java >& /dev/null \
		|| abort 'failed to compile. javac required.'
}

JDK_VERSION='1.2'
PROP_NAMES=()
if [ "$PJP_JAVA" = "" ]; then
	PJP_JAVA='java'
fi

cd "$(dirname "${BASH_SOURCE[0]}")/../lib"

while (( $# > 0 )); do
	case "$1" in
		'--compile' | '-c' )
			compile
			echo 'compile done.'
			exit 0
			;;
		--java* )
			PJP_JAVA="${1:6}"
			;;
		-j* )
			PJP_JAVA="${1:2}"
			;;
		* )
			PROP_NAMES+=("$1")
			;;
	esac
	shift 1
done

if [ ! -f ./pjp.class ]; then
	compile
fi

"$PJP_JAVA" pjp ${PROP_NAMES[@]}
